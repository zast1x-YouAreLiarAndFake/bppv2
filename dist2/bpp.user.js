// ==UserScript==
// @name         Blacket++
// @description  the best client modification for blacket
// @version      0.0.0
// @icon         https://blacket.org/content/logo.png

// @author       zastix & allie
// @namespace    https://bpp.zastix.club

// @match        *://rewrite.blacket.org/*
// @match        *://159.65.251.176:3000/*
// @match        *://localhost:6900/*

// @grant        none
// @run-at document-end
// ==/UserScript==

(()=>{var te=Object.create;var O=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var ie=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var se=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ne(e))!re.call(n,r)&&r!==t&&O(n,r,{get:()=>e[r],enumerable:!(o=oe(e,r))||o.enumerable});return n};var ce=(n,e,t)=>(t=n!=null?te(ae(n)):{},se(e||!n||!n.__esModule?O(t,"default",{value:n,enumerable:!0}):t,n));var p=class{constructor(e,t="white"){this._name=e;this.color=t}static makeTitle(e,t){return["%c %c %s ","",`background: ${e}; color: black; font-weight: bold; border-radius: 5px;`,t]}_log(e,t,o){console[e](`%c BPP %c %c ${this._name}`,`background: ${t}; color: black; font-weight: bold; border-radius: 5px;`,"",`background: ${this.color}; color: black; font-weight: bold; border-radius: 5px;`,...o)}info(...e){this._log("info","#a6d189",e)}error(...e){this._log("error","#e78284",e)}warn(...e){this._log("warn","#e5c890",e)}},y=p;var B=["a","b","i"],g=new Map;function j(n,e,t,o,r){let a=g.get(e)?.[n];if(!a)return r?Reflect.construct(e[n],t,o):e[n].apply(o,t);for(let s of a.b.values()){let c=s.call(o,t);Array.isArray(c)&&(t=c)}let i=[...a.i.values()].reduce((s,c)=>(...d)=>c.call(o,d,s),(...s)=>r?Reflect.construct(a.o,s,o):a.o.apply(o,s))(...t);for(let s of a.a.values())i=s.call(o,t,i)??i;return i}function E(n,e,t,o){let r=g.get(n),a=r?.[e];return a?.[o].has(t)?(a[o].delete(t),B.every(i=>a[i].size===0)&&(Reflect.defineProperty(n,e,{value:a.o,writable:!0,configurable:!0})||(n[e]=a.o),delete r[e]),Object.keys(r).length==0&&g.delete(n),!0):!1}var P=n=>(e,t,o,r=!1)=>{if(typeof t[e]!="function")throw new Error(`${e} is not a function in ${t.constructor.name}`);g.has(t)||g.set(t,Object.create(null));let a=g.get(t);if(!a[e]){let c=t[e];a[e]={o:c,b:new Map,i:new Map,a:new Map};let d=(f,h,b)=>{let ee=j(e,t,h,f,b);return r&&s(),ee},x=new Proxy(c,{apply:(f,h,b)=>d(h,b,!1),construct:(f,h)=>d(c,h,!0),get:(f,h,b)=>h=="toString"?c.toString.bind(c):Reflect.get(f,h,b)});Reflect.defineProperty(t,e,{value:x,configurable:!0,writable:!0})||(t[e]=x)}let i=Symbol(),s=()=>E(t,e,i,n);return a[e][n].set(i,o),s};var Be=P("b"),je=P("i"),I=P("a");var D=n=>{let e={React:"useState",ReactDOM:".onRecoverableError",SocketIOClient:"io"};n.vendors.vendors=Object.fromEntries(Object.entries(n.vendors._vendors)),n.vendors.normalized={React:Object.values(n.vendors.vendors).find(o=>o[e.React]),ReactDOM:Object.values(n.vendors.vendors).find(o=>o.toString().includes(e.ReactDOM)),SocketIOClient:Object.values(n.vendors.vendors).find(o=>o[e.SocketIOClient])},n.vendors.map={React:Object.keys(n.vendors.vendors).find(o=>n.vendors.vendors[o]===n.vendors.normalized.React),ReactDOM:Object.keys(n.vendors.vendors).find(o=>n.vendors.vendors[o]===n.vendors.normalized.ReactDOM),SocketIOClient:Object.keys(n.vendors.vendors).find(o=>n.vendors.vendors[o]===n.vendors.normalized.SocketIOClient)};let t={modal:"setModals",user:"setUser",socket:"initializeSocket",fonts:"setFonts",config:"setConfig",loading:"setLoading",leaderboard:"setLeaderboard",blooks:"setBlooks",rarities:"setRarities",packs:"setPacks",items:"setItems",banners:"setBanners",badges:"setBadges",emojis:"setEmojis",cachedUsers:"addCachedUser",chat:"usersTyping",contextManu:"closeContextMenu"};I("createContext",n.vendors.normalized.React,(o,r)=>{let a=Object.entries(t).find(i=>o[0]?.[i[1]])?.[0];a&&(n.storeProviders[a]=r)})},T=(n,e)=>()=>{for(let t in e.storeProviders)e.stores[t]=e.vendors.normalized.React.useContext(e.storeProviders[t]);return window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(n,null)};var m={zastix:{name:"zastix",id:"17153937091571944",avatar:"https://zastix.club/resources/pfps/pfp_crop.png"},allie:{name:"allie",id:"idk",avatar:"idk"}},C=Object.values(m);console.log(C);var u=class extends p{name;version;description;authors;patches;enabled=!1;constructor(e,t="0.0.1",o="An example plugin",r){super(e),this.name=e,this.version=t,this.description=o,this.authors=r,this.patches=[]}addPatch(e){this.patches.push({...e,plugin:this.name})}addPatches(e){let t=e.map(o=>({...o,plugin:this.name}));this.patches.push(...t)}onEnable(){}onDisable(){}};var L=[["wrapper","leaderboard"],["parentHolder","dashboard"]].map(n=>({match:new RegExp(`const (.{0,4})={${n[0]}:"${n[1]}`),replace:`const $1=$self.styles["${n[1]}"]={${n[0]}:"${n[1]}`}));var A="n",H="t";var z=()=>{let{blacketScope:n}=l.pluginManager.getPlugin("Internals"),e=n("be"),t=n("t"),o=l.pluginManager.getPlugin("Internals").styles.dashboard,r=[{icon:"fas fa-wand-magic-sparkles",text:"Plugins",link:"/bpp/plugins"},{icon:"fas fa-cog",text:"Settings",link:"/bpp/credits"},{icon:"fas fa-palette",text:"Themes",link:"/bpp/themes"}];return window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.Fragment,null,window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(e,null,"Blacket++"),window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("div",{className:A},window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("div",{style:{height:"20vh"},className:`${o.smallButtonContainer} ${H}`},r.map((a,i)=>window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(t,{to:a.link,className:o.topRightButton,key:i},window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("i",{className:a.icon}),window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("div",null,a.text))))))};var de={name:"BPP",path:"/bpp",title:"BPP | Blacket Rewrite",topRight:["tokens"],sidebar:!0,background:!0,dontUseBody:!1,component:()=>window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(z,null)},U=de;var N="e",_="p",W="r";var V=()=>{let{blacketScope:n}=l.pluginManager.getPlugin("Internals"),e=n("be"),t=n("Lo"),o=l.pluginManager.getPlugin("Internals").styles.dashboard,{useEffect:r,useState:a}=l.pluginManager.getPlugin("Internals").vendors.normalized.React,i=l.pluginManager.getPlugins(),[s,c]=a();return window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.Fragment,null,window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(e,null,"Blacket++"),window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("div",{className:N},window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("div",{style:{height:"20vh"},className:`${o.smallButtonContainer} ${_}`},i.filter(d=>d.name!=="Internals").map((d,x)=>window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(t,{header:{text:d.name,icon:"fa-solid fa-box"},key:x},window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",height:"100%"}},window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("span",null,d.description),window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("div",{className:W,onClick:()=>{let Z=l.pluginManager.getPlugin(d.name)}})))))))};var he={name:"BPPPlugins",path:"/bpp/plugins",title:"BPP Plugins | Blacket Rewrite",topRight:["tokens"],sidebar:!0,background:!0,dontUseBody:!1,component:()=>window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement(V,null)},J=he;var me=[U,J],K=me;var S=class extends u{constructor(){super("Internals","0.0.1","A plugin handling internal features of BPP",[m.zastix]),this.addPatches([{find:'textures.getFrame("__DEFAULT").glTexture',replacement:[{match:/\.Phaser=(.{0,2})\(\)}\(this,/,replace:".Phaser=$1()}(window,"}]},{find:"__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED",replacement:[{match:/from".\/index.(.{0,10}).js/,replace:`from"${location.origin}/index.$1.js`}]},{find:"iridescent",replacement:[{match:/import"\.\/index\.(.{0,})\.js";/,replace:"$self.blacketScope=(a)=>eval(a);"},{match:/import\{(.{0,})\}from"\.\/vendor\.(.{0,10})\.js"/,replace:(e,...t)=>`$self.vendors={};$self.vendors._vendors=await import("${l.patchManager.files.find(o=>o.path.match(/vendor/)).patchedPath}");$self.handleVendors($self);const {${Object.entries([...t[0].matchAll(/(.{0,1}) as (.{0,1})/g)].reduce((o,[,r,a])=>(o[r]=a,o),{})).reduce((o,r)=>o+`${r[0]}:${r[1]},`,"").slice(0,-1)}}=BPP.pluginManager.getPlugin("Internals").vendors.vendors;$self.pages=$self.pages.map(a=>{a.component=a.component();return a;});$self.styles={};`},{match:/AuctionHouse:(.{0,3}),/,replace:(e,...t)=>`AuctionHouse:${t[0]},${this.pages.map((o,r)=>`${o.name}:$self.pages[${r}]`).join(",")},`},{match:/{to:"\/store",icon:"fas fa-cart-shopping",className:(.{0,3}),backgroundColor:"#2b22c2",children:"Visit Store"}/,replace:'{to:"/bpp",icon:"fas fa-plus",className:$1,backgroundColor:"#ff00d8",children:"BPP"}'},{match:/t:(.{0,2})\.jsx\((.{0,2}),{children:(.{0,2})\.jsx\((.{0,2}),/,replace:"t:$1.jsx($2,{children:$3.jsx($self.componentHook($4,$self),"},...L]}])}handleVendors=D;componentHook=T;stores={};storeProviders={};blacketScope(e){}pages=K;vendors;styles},X=new S;var w=class extends u{constructor(){super("Test","0.0.1","Test",[m.zastix])}onEnable(){console.log(window.BPP.pluginManager.pluginList.Internals.vendors.normalized.React.createElement("h1",null,"gyat"))}},Y=new w;var q=()=>[Y,X];var R=class extends p{plugins=[];pluginList={};inited=!1;constructor(){super("PluginManager","#F5A9B8")}init(){this.plugins=q(),this.pluginList=this.plugins.reduce((e,t)=>(e[t.name]=t,e),{}),this.info("Initialized"),this.inited=!0}enableAll(){this.plugins.forEach(e=>{e.enabled=!0,e.onEnable()})}disableAll(){this.plugins.forEach(e=>{e.enabled=!1,e.onDisable()})}enablePlugin(e){let t=this.getPlugin(e);t&&(t.enabled=!0,t.onEnable())}disablePlugin(e){let t=this.getPlugin(e);t&&(t.enabled=!1,t.onDisable())}togglePlugin(e){let t=this.getPlugin(e);t&&(t.enabled=!t.enabled,t.enabled?t.onEnable():t.onDisable())}getPlugin(e){return this.plugins.find(t=>t.name===e)}getPlugins(){return this.plugins}hasInitialized(){return this.inited}},G=R;var $=class{subscriptions=new Map;subscribe(e,t){y.info("Events",`Subscribed to event '${e}'.`),this.subscriptions.has(e)||this.subscriptions.set(e,new Set),this.subscriptions.get(e).add(t)}dispatch(e,t){y.info("Events",`Dispatched event '${e}'.`),this.subscriptions.has(e)&&this.subscriptions.get(e).forEach(o=>o(t))}},ue=new $,Q=ue;var v=class extends p{blacklistedFiles=[];inited=!1;allPatches=[];files=[];constructor(){super("PatchManager","#5BCEFA")}init(){this.info("Initialized"),this.inited=!0}addFile(e){this.files.push(e)}addPatch(e){this.allPatches.push(e)}addPatches(e){this.allPatches.push(...e)}_applyPatches(){for(let e of this.files.reverse()){e.patched=e.original;let t=this.allPatches.filter(o=>o.find instanceof RegExp?o.find.test(e.original):e.original.includes(o.find));for(let o of t){let r=e.patched;if(Array.isArray(o.replacement))for(let a of o.replacement){let i=e.patched;a.replace instanceof Function?e.patched=e.patched.replace(a.match,a.replace(e.patched.match(a.match)[0],...e.patched.match(a.match).slice(1))).replaceAll("$self",`window.BPP.pluginManager.getPlugin("${o.plugin}")`):e.patched=e.patched.replace(a.match,a.replace).replaceAll("$self",`window.BPP.pluginManager.getPlugin("${o.plugin}")`),i===e.patched&&this.warn(`Patch "${a.match}" by plugin "${o.plugin}" had no effect.`)}else{let a=e.patched;o.replacement.replace instanceof Function?e.patched=o.replacement.replace(e.patched.match(o.replacement.match)[0],...e.patched.match(o.replacement.match).slice(1)).replaceAll("$self",`window.BPP.pluginManager.getPlugin("${o.plugin}")`):e.patched=e.patched.replace(o.replacement.match,o.replacement.replace).replaceAll("$self",`window.BPP.pluginManager.getPlugin("${o.plugin}")`),a===e.patched&&this.warn(`Patch "${o.replacement.match}" by plugin "${o.plugin}" had no effect.`)}r!==e.patched&&!e.patchedBy.includes(o.plugin)&&e.patchedBy.push(o.plugin)}e.patchedPath=URL.createObjectURL(new Blob([`// ${e.path.replace(`${location.origin}/`,"")} ${e.patchedBy.length>0?`- Patched By ${e.patchedBy.join(", ")}`:""}
`,e.patched],{type:"application/javascript"}))}}async softReload(e){this.files=[],document.open();let t=new DOMParser().parseFromString(await(await fetch(document.location.href)).text(),"text/html");Array.from(t.head.getElementsByTagName("link")).filter(a=>a.rel==="modulepreload"&&!this.blacklistedFiles.some(i=>i.test(a.href))).forEach(a=>a.remove());let o=[...t.head.getElementsByTagName("script")].filter(a=>this.blacklistedFiles.every(i=>!i.test(a.src))).map(a=>a.cloneNode());for(let a of o){let i=a;if(i.nodeType!==1||i.tagName!=="SCRIPT")continue;let s={path:i.src,original:await(await fetch(i.src)).text(),patched:"",patchedBy:[],patchedPath:""};this.addFile(s),i.src.match(/index/g)&&this.addFile({path:`${location.origin}/vendor.${s.original.match(/from".\/vendor.(.{0,10}).js"/)[1]}.js`,original:await(await fetch(`${location.origin}/vendor.${s.original.match(/from".\/vendor.(.{0,10}).js"/)[1]}.js`)).text(),patched:"",patchedBy:[],patchedPath:""})}this._applyPatches(),[...t.head.children].forEach(a=>{a.tagName==="SCRIPT"&&a.remove()}),document.write(t.documentElement.innerHTML),document.close();let r=document.createElement("style");r.innerHTML=".o{color:#fff}.i{font-family:Titan One,sans-serif}.n{filter:drop-shadow(0px 4px 4px rgba(0,0,0,.25));border-radius:7px;padding-top:6vh;padding-bottom:6vh;margin-left:10vw;margin-right:10vw;background-color:#00000020}.t{padding-top:0;display:flex;flex-direction:row;align-content:center}.a{color:#fff}.d{font-family:Titan One,sans-serif}.e{filter:drop-shadow(0px 4px 4px rgba(0,0,0,.25));border-radius:7px;padding-top:6vh;padding-bottom:6vh;margin-left:10vw;margin-right:10vw;background-color:#00000020}.p{padding-top:0;display:flex;flex-direction:row;align-content:center}.r{background-color:transparent;border:3px solid white;border-radius:5px;width:10px;height:10px;transition:background-color .2s}.r.g{background-color:#fff}",document.head.append(r);for(let a of o){let i=a;if(i.nodeType!==1||i.tagName!=="SCRIPT")continue;let s=document.createElement("script");s.type="module",s.async=!0,s.src=e?this.files.find(c=>c.path===i.src).patchedPath:i.src,document.head.append(s)}}};var M=class extends p{pluginManager=new G;patchManager=new v;pages={};consts={Devs:m,devsArray:C};utils={events:Q};constructor(){super("BPP","#5BCEFA"),this.pluginManager.init(),this.patchManager.init(),this.patchManager.addPatches(this.pluginManager.getPlugins().map(e=>e.patches).flat()),this.patchManager.softReload(!0)}},l=new M;window.BPP=l;(async()=>{{if(window.devWs)return;console.log("Dev mode enabled, connecting to dev hot-reload server...");let n=(await import("https://cdn.jsdelivr.net/npm/reconnecting-websocket/+esm")).default;window.devWs=new n("ws://localhost:3000/ws",[],{maxRetries:10}),window.devWs.onopen=()=>window.devWs.send(JSON.stringify({type:"register"})),window.devWs.onmessage=async e=>{switch(JSON.parse(e.data).type){case"reload":delete window.BPP,(0,eval)(await(await fetch("http://localhost:3000/bpp.min.js")).text());break;case"hmr":}}}})();})();
// made with ❤️ by zastix and allie, https://github.com/zastlx/bppv2
//# sourceMappingURL=bpp.min.js.map